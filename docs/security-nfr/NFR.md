# Security Non-Functional Requirements

| ID        | Название                                           | Описание                                                                                 | Метрика / Порог                                                                                               | Способ проверки                                                                                                          | Компонент                                         | Приоритет |
|-----------|----------------------------------------------------|------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|------------|
| NFR-S01   | Авторизация для мутаций API                        | Предотвращаем несанкционированные изменения данных через REST API                       | 100% `POST`/`PUT`/`DELETE` запросов без валидного токена получают `401`; ни один несанкционированный апдейт     | Pytest-интеграционные тесты с кейсами авторизованного/неавторизованного доступа, прогоняются в CI                       | FastAPI контроллеры `/items` (POST/PUT/DELETE)    | P0         |
| NFR-S02   | TLS 1.2+ для внешнего трафика                      | Исключаем приём незашифрованных запросов и слабых протоколов                             | 100% внешних запросов обслуживаются по HTTPS; HTTP отклоняется/редиректится; отчёт SSL Labs ≥ «A»              | Автотест `curl --proto '=https' --tlsv1.2`; ежеквартальный отчёт Qualys SSL Labs; мониторинг сертификатов               | Входной прокси/ingress (reverse proxy + Uvicorn) | P1         |
| NFR-S03   | Аудит действий пользователей                       | Фиксируем все мутации для расследования инцидентов                                       | 100% мутаций логируются ≤ 2 сек с полями `user_id`, `action`, timestamp; хранение ≥ 90 дней                     | Интеграционный тест проверяет запись structured log; ревью настроек ротации и Retention policy                          | Подсистема логирования / storage                  | P1         |
| NFR-S04   | Контроль уязвимостей зависимостей                  | Не допускаем критичные CVE в поставку                                                  | 0 критических/высоких (CVSS ≥ 7.0) уязвимостей в `requirements*.txt`; пайплайн блокирует PR при нарушении      | Джоб CI `pip-audit`/`safety` по каждому PR; еженедельный отчёт об инвентаризации зависимостей                           | CI/CD пайплайн + управление зависимостями         | P0         |
| NFR-S05   | Защита от перебора / Rate limiting                 | Ограничиваем brute-force и DoS через массовые запросы                                   | ≥ 95% повторных запросов с одного IP сверх 60/мин получают `429`; задержка ответа ≤ 100 мс поверх лимита       | Нагрузочный тест Locust/k6 nightly; анализ метрик reverse proxy / APM                                                     | Reverse proxy / middleware rate-limiter           | P2         |
| NFR-S06   | Управление секретами                               | Секреты не хранятся в коде и регулярно ротируются                                       | 0 секретов в репозитории; 100% секретов в Secret Manager; срок жизни каждого секрета ≤ 30 дней                  | Еженедельная проверка `trufflehog` в CI; отчёт Secret Manager о дате последней ротации; ручная проверка перед релизом    | Vault/Secret Manager + CI                        | P0         |
| NFR-S07   | Безопасные HTTP-заголовки                          | Принудительно включаем защитные заголовки приложения                                    | 100% ответов имеют заголовки `Strict-Transport-Security`, `Content-Security-Policy`, `X-Content-Type-Options` | Автотест DAST (`owasp-zap` baseline) + smoke `curl -I`; мониторинг CSP violation reports                                 | Reverse proxy / FastAPI middleware                | P1         |
| NFR-S08   | Шифрование и восстановление резервных копий        | Гарантируем целостность и конфиденциальность бэкапов                                    | 100% резервных копий шифруются AES-256; ежемесячный тест восстановления < 15 минут RTO                         | Плановый restore-тест в staging; проверка конфигурации backup-скриптов и журналов шифрования                              | Backup service + storage                         | P2         |
| NFR-S09   | Валидация входных данных и защита от инъекций      | Исключаем выполнение вредоносных payload через API                                      | 0 уязвимостей класса injection (OWASP A03) в отчётах SAST/DAST; 100% полей проходят валидацию схемами          | CI: `bandit`/`semgrep` SAST, ежемесячный ZAP scan; unit-тесты на rejects опасных payload                                 | FastAPI схемы и валидаторы                       | P0         |
